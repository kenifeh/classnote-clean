<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassNote AI - Simple Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #output {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .section-title {
            font-weight: bold;
            color: #333;
            margin: 15px 0 10px 0;
            font-size: 18px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        .transcription-text {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
        }
        .summary-text {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #28a745;
        }
        .loading {
            color: #007bff;
            font-style: italic;
        }
        .error {
            color: #dc3545;
        }
        .success {
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéì ClassNote AI - Simple Test</h1>
        <div style="text-align: center;">
            <button onclick="testAPI()" id="testBtn">Test API (No File Upload)</button>
            <button onclick="testWithFile()" id="fileBtn">Test with File Upload</button>
        </div>
        <div id="output">Click a button to test the API...</div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001';
        const CACHE_BUSTER = Date.now() + Math.random();

        async function testAPI() {
            const output = document.getElementById('output');
            const testBtn = document.getElementById('testBtn');
            
            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            output.innerHTML = '<span class="loading">Testing API endpoints...</span>';

            try {
                // Test 1: Health check
                output.innerHTML = '<span class="loading">Testing health check...</span>';
                const healthRes = await fetch(`${API_URL}/?t=${CACHE_BUSTER}`, {
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });
                const healthData = await healthRes.json();
                
                // Test 2: Summarization with sample text
                output.innerHTML = '<span class="loading">Testing summarization...</span>';
                const sampleText = "Welcome to today's lecture on artificial intelligence and machine learning. We'll be discussing the fundamentals of neural networks, deep learning algorithms, and their applications in modern technology. The field of AI has evolved significantly over the past decade, with breakthroughs in natural language processing, computer vision, and autonomous systems.";
                
                const summarizeRes = await fetch(`${API_URL}/summarize?t=${CACHE_BUSTER}`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    },
                    body: JSON.stringify({ text: sampleText }),
                });
                
                const summarizeData = await summarizeRes.json();
                
                // Display results
                output.innerHTML = `
                    <div class="section-title">‚úÖ Health Check Response</div>
                    <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px;">
                        ${JSON.stringify(healthData, null, 2)}
                    </div>
                    
                    <div class="section-title">üìù Sample Text Used</div>
                    <div class="transcription-text">${sampleText}</div>
                    
                    <div class="section-title">üìã Summarization Response</div>
                    <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px;">
                        ${JSON.stringify(summarizeData, null, 2)}
                    </div>
                    
                    <div class="section-title">üìã Generated Summary</div>
                    <div class="summary-text">${summarizeData.summary}</div>
                    
                    <div class="section-title">üéâ Test Results</div>
                    <div class="success">
                        ‚úÖ Health check: Working<br>
                        ‚úÖ Summarization: Working<br>
                        ‚úÖ Demo mode: Active<br>
                        <br>
                        The API is working correctly! The demo mode is providing realistic responses.
                    </div>
                `;
                
            } catch (error) {
                console.error("Error:", error);
                output.innerHTML = `<span class="error">Error: ${error.message}</span>`;
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'Test API (No File Upload)';
            }
        }

        async function testWithFile() {
            const output = document.getElementById('output');
            const fileBtn = document.getElementById('fileBtn');
            
            fileBtn.disabled = true;
            fileBtn.textContent = 'Testing...';
            output.innerHTML = '<span class="loading">Testing with file upload...</span>';

            try {
                // Create a dummy audio file
                const dummyContent = 'This is a test audio file content';
                const blob = new Blob([dummyContent], { type: 'audio/mp3' });
                const file = new File([blob], 'test-audio.mp3', { type: 'audio/mp3' });
                
                const formData = new FormData();
                formData.append('audio', file);
                
                output.innerHTML = '<span class="loading">Testing transcription...</span>';
                
                const transcribeRes = await fetch(`${API_URL}/transcribe?t=${CACHE_BUSTER}`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });

                if (!transcribeRes.ok) {
                    throw new Error(`Transcribe error: ${transcribeRes.statusText}`);
                }

                const transcribeData = await transcribeRes.json();
                
                // Test summarization with the transcription
                output.innerHTML = '<span class="loading">Testing summarization...</span>';
                
                const summarizeRes = await fetch(`${API_URL}/summarize?t=${CACHE_BUSTER}`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    },
                    body: JSON.stringify({ text: transcribeData.text }),
                });

                if (!summarizeRes.ok) {
                    throw new Error(`Summarize error: ${summarizeRes.statusText}`);
                }

                const summarizeData = await summarizeRes.json();
                
                // Display results
                output.innerHTML = `
                    <div class="section-title">üîç Transcription API Response</div>
                    <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px;">
                        ${JSON.stringify(transcribeData, null, 2)}
                    </div>
                    
                    <div class="section-title">üìù Generated Transcription</div>
                    <div class="transcription-text">${transcribeData.text}</div>
                    
                    <div class="section-title">üîç Summarization API Response</div>
                    <div style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; font-size: 12px;">
                        ${JSON.stringify(summarizeData, null, 2)}
                    </div>
                    
                    <div class="section-title">üìã Generated Summary</div>
                    <div class="summary-text">${summarizeData.summary}</div>
                    
                    <div class="section-title">üéâ File Upload Test Results</div>
                    <div class="success">
                        ‚úÖ File upload: Working<br>
                        ‚úÖ Transcription: Working<br>
                        ‚úÖ Summarization: Working<br>
                        ‚úÖ Demo mode: Providing realistic content<br>
                        <br>
                        The full pipeline is working correctly!
                    </div>
                `;
                
            } catch (error) {
                console.error("Error:", error);
                output.innerHTML = `<span class="error">Error: ${error.message}</span>`;
            } finally {
                fileBtn.disabled = false;
                fileBtn.textContent = 'Test with File Upload';
            }
        }
    </script>
</body>
</html> 